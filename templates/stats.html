{% extends "base.html" %}

{% block title %}Stats{% endblock %}

{% block content %}
    <h2>Your Spotify statistics</h2>

    {% if view == 'top_tracks' %}
    {% if top_artist %}
        <h3>Top Artist</h3>
        <p>{{ top_artist.name }}</p>
        {% if top_artist.images %}
            <img src="{{ top_artist.images[0].url }}" alt="Top Artist Image" class="top-artist-img" width="250">
        {% endif %}
    {% else %}
        <p class="top-artist-name">No top artist data available.</p>
    {% endif %}
    
    <h3>Top 5 tracks:</h3>
        <ul class="tracks">
            {% for track in top_tracks %}
            <li>
                <img src="{{ track.album.images[0].url }}" alt="Track Image">
                <strong>{{ track.name }}</strong>
                    by {{ track.artists[0].name }}<br>
                    <a href="{{ track.external_urls.spotify }}" class="spotify-btn" target="_blank">Listen on Spotify</a>
            </li>
            {% endfor %}
        </ul>
    {% endif %}

    {% if view == 'recently_played' %}
    <h3>Recently Played Tracks:</h3>
    <ul class="tracks">
        {% for item in recently_played %}
        <li>
            <img src="{{ item.track.album.images[0].url }}" alt="Track Image">
            <strong>{{ item.track.name }}</strong><br>
            by {{ item.track.artists[0].name }}<br>
            <small>Played at: {{ item.played_at[:10] }} {{ item.played_at[11:16] }}</small><br>
            <a href="{{ item.track.external_urls.spotify }}" class="spotify-btn" target="_blank">Listen on Spotify</a>
        </li>
        {% endfor %}
    </ul>
    {% endif %}

    {% if view == 'by_popularity' %}
    <h3>Top 5 Tracks by Popularity:</h3>
    <ul class="tracks">
        {% for track in top_tracks %}
        <li>
            <img src="{{ track.album.images[0].url }}" alt="Track Image">
            <strong>{{ track.name }}</strong><br>
            by {{ track.artists[0].name }}<br>
            Popularity: {{ track.popularity }}<br>
            <a href="{{ track.external_urls.spotify }}" class="spotify-btn" target="_blank">Listen on Spotify</a>
        </li>
        {% endfor %}
    {% endif %}
</ul>

{% endblock %}